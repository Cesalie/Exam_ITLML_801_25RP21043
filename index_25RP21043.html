<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Disease Risk Prediction - CHUB</title>
    <style>
        /* General Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; font-weight: 700; }
        .status {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 15px;
        }
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 40px;
        }
        .input-section h2, .result-section h2 {
            color: #1e3c72;
            margin-bottom: 25px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        .form-group input, .form-group select {
            width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em;
        }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .button-group { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 30px; }
        button { padding: 14px 28px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.3s; }
        .btn-predict { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; grid-column: 1 / -1; }
        .btn-clear { background: #e0e0e0; color: #333; }
        
        /* Loading Spinner */
        .loading { display: none; text-align: center; padding: 20px; }
        .spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%;
            width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 15px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Result Cards */
        .result-container { background: #f8f9fa; border-radius: 12px; padding: 25px; display: none; }
        .result-container.show { display: block; animation: slideIn 0.5s ease; }
        .risk-card {
            background: white; border-radius: 12px; padding: 25px; margin-bottom: 20px;
            border-left: 6px solid #ccc; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        /* Dynamic Risk Colors */
        .risk-card.healthy { border-color: #28a745; }
        .risk-card.low-risk { border-color: #17a2b8; }
        .risk-card.medium { border-color: #ffc107; }
        .risk-card.high { border-color: #fd7e14; }
        .risk-card.critical { border-color: #dc3545; }

        .predicted-class { font-size: 1.8em; font-weight: 700; text-transform: capitalize; color: #1e3c72; }
        .risk-level { 
            display: inline-block; padding: 5px 15px; border-radius: 15px; 
            color: white; font-weight: bold; margin-top: 10px; font-size: 0.9em;
        }
        .risk-level.healthy { background: #28a745; }
        .risk-level.low-risk { background: #17a2b8; }
        .risk-level.medium { background: #ffc107; color: #333; }
        .risk-level.high { background: #fd7e14; }
        .risk-level.critical { background: #dc3545; }

        .prob-bar { background: #eee; height: 20px; border-radius: 10px; overflow: hidden; margin: 5px 0 15px 0; }
        .prob-fill { height: 100%; background: #667eea; color: white; font-size: 0.8em; text-align: center; line-height: 20px; }
        .error-message { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 8px; display: none; margin-bottom: 20px; }
        
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @media (max-width: 768px) { .content { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Heart Disease Risk Prediction System</h1>
            <p>CHUB - Referral and Teaching Hospital Cardiovascular Unit</p>
            <div class="status" id="status"><span id="status-text">Connecting to Server...</span></div>
        </div>

        <div class="content">
            <div class="input-section">
                <h2>ðŸ“‹ Patient Information</h2>
                <div class="error-message" id="error-message"></div>

                <form id="prediction-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Age (years)</label>
                            <input type="number" name="age" placeholder="e.g. 45" required>
                        </div>
                        <div class="form-group">
                            <label>Sex</label>
                            <select name="sex" required>
                                <option value="">Select...</option>
                                <option value="female">Female</option>
                                <option value="male">Male</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Chest Pain Type</label>
                        <select name="cp" required>
                            <option value="">Select...</option>
                            <option value="typical angina">Typical Angina</option>
                            <option value="atypical angina">Atypical Angina</option>
                            <option value="non-anginal">Non-anginal Pain</option>
                            <option value="asymptomatic">Asymptomatic</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Resting BP (mmHg)</label>
                            <input type="number" name="trestbps" placeholder="e.g. 120" required>
                        </div>
                        <div class="form-group">
                            <label>Cholesterol (mg/dl)</label>
                            <input type="number" name="chol" placeholder="e.g. 200" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Fasting Blood Sugar > 120 mg/dl</label>
                        <select name="fbs" required>
                            <option value="">Select...</option>
                            <option value="false">No (Normal)</option>
                            <option value="true">Yes (High)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Resting ECG Results</label>
                        <select name="restecg" required>
                            <option value="">Select...</option>
                            <option value="normal">Normal</option>
                            <option value="st-t wave">ST-T Wave Abnormality</option>
                            <option value="hypertrophy">Left Ventricular Hypertrophy</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Max Heart Rate</label>
                            <input type="number" name="thalach" placeholder="e.g. 150" required>
                        </div>
                        <div class="form-group">
                            <label>Exercise Angina</label>
                            <select name="exang" required>
                                <option value="">Select...</option>
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Oldpeak (ST Dep.)</label>
                            <input type="number" step="0.1" name="oldpeak" placeholder="e.g. 1.5" required>
                        </div>
                        <div class="form-group">
                            <label>Slope of ST Segment</label>
                            <select name="slope" required>
                                <option value="">Select...</option>
                                <option value="upsloping">Upsloping</option>
                                <option value="flat">Flat</option>
                                <option value="downsloping">Downsloping</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Major Vessels (0-3)</label>
                            <input type="number" name="ca" min="0" max="3" required>
                        </div>
                        <div class="form-group">
                            <label>Thalassemia</label>
                            <select name="thal" required>
                                <option value="">Select...</option>
                                <option value="normal defect">Normal</option>
                                <option value="fixed defect">Fixed Defect</option>
                                <option value="reversable defect">Reversible Defect</option>
                            </select>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="button" class="btn-clear" onclick="clearForm()">Clear</button>
                        <button type="submit" class="btn-predict">Analyze Risk</button>
                    </div>
                </form>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Processing Clinical Data...</p>
                </div>
            </div>

            <div class="result-section">
                <h2>ðŸ“Š Analysis Results</h2>
                <div id="no-prediction" class="risk-card" style="text-align: center; color: #666;">
                    Enter patient data and click Analyze Risk to see results.
                </div>

                <div class="result-container" id="result-container">
                    <div class="risk-card" id="risk-card">
                        <div class="predicted-class" id="predicted-class">No Data</div>
                        <div id="risk-badge" class="risk-level">Unknown</div>
                        <div style="margin-top: 15px; font-weight: 600;" id="confidence">Confidence: 0%</div>
                        <div class="clinical-interpretation" id="clinical-interpretation" style="margin-top: 10px; color: #555; font-style: italic;"></div>
                        <div id="timestamp" style="font-size: 0.8em; color: #999; margin-top: 15px;"></div>
                    </div>

                    <div class="risk-card">
                        <h4 style="margin-bottom:15px;">Probability Distribution</h4>
                        <div id="prob-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';

        // Check Server Status on Load
        window.onload = () => {
            fetch(`${API_URL}/health`)
                .then(res => res.json())
                .then(data => {
                    const statusText = document.getElementById('status-text');
                    if(data.status === 'healthy') {
                        statusText.innerText = 'â— System Online';
                        statusText.parentElement.style.background = 'rgba(40, 167, 69, 0.4)';
                    }
                })
                .catch(() => {
                    document.getElementById('status-text').innerText = 'â—‹ System Offline';
                });
        };

        async function handlePrediction(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            // UI Reset
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error-message').style.display = 'none';
            document.getElementById('result-container').classList.remove('show');
            document.getElementById('no-prediction').style.display = 'none';

            try {
                const response = await fetch(`${API_URL}/predict`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    displayResults(result);
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                const errDiv = document.getElementById('error-message');
                errDiv.innerText = "Error: " + error.message;
                errDiv.style.display = 'block';
                document.getElementById('no-prediction').style.display = 'block';
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        function displayResults(data) {
            const container = document.getElementById('result-container');
            const riskCard = document.getElementById('risk-card');
            const badge = document.getElementById('risk-badge');
            
            const riskClass = data.risk_level.toLowerCase().replace(' ', '-');

            // Set content
            document.getElementById('predicted-class').innerText = data.predicted_class;
            document.getElementById('confidence').innerText = `Model Confidence: ${data.confidence}%`;
            document.getElementById('clinical-interpretation').innerText = data.clinical_interpretation;
            document.getElementById('timestamp').innerText = `Reference ID: ${new Date().getTime()} | Generated: ${new Date().toLocaleString()}`;

            // Styling
            riskCard.className = `risk-card ${riskClass}`;
            badge.className = `risk-level ${riskClass}`;
            badge.innerText = `${data.risk_level} Risk`;

            // Probabilities
            const probList = document.getElementById('prob-list');
            probList.innerHTML = '';
            Object.entries(data.per_class_probabilities).forEach(([cls, val]) => {
                probList.innerHTML += `
                    <div style="font-size: 0.9em; display:flex; justify-content:space-between">
                        <span>${cls}</span><span>${val}%</span>
                    </div>
                    <div class="prob-bar">
                        <div class="prob-fill" style="width: ${val}%"></div>
                    </div>
                `;
            });

            container.classList.add('show');
        }

        function clearForm() {
            document.getElementById('prediction-form').reset();
            document.getElementById('result-container').classList.remove('show');
            document.getElementById('no-prediction').style.display = 'block';
        }

        document.getElementById('prediction-form').addEventListener('submit', handlePrediction);
    </script>
</body>
</html>